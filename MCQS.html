<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive MCQ Practice App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind CSS to use class-based dark mode
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <!-- pdf.js for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <!-- mammoth.js for DOCX parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .option-btn {
            transition: all 0.2s ease-in-out;
        }
        .option-btn.selected {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .correct {
            background-color: #10B981 !important; /* Green-500 */
            color: white !important;
            border-color: #059669 !important;
        }
        .incorrect {
            background-color: #EF4444 !important; /* Red-500 */
            color: white !important;
            border-color: #DC2626 !important;
        }
        .correct-answer-reveal {
             background-color: #3B82F6 !important; /* Blue-500 */
            color: white !important;
            border-color: #2563EB !important;
        }

        #app-container {
            min-height: 100vh;
        }
        
        /* For the new question navigation panel */
        #question-nav-panel::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        #question-nav-panel::-webkit-scrollbar-thumb {
            background-color: #9CA3AF;
            border-radius: 20px;
        }

    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <div id="app-container" class="relative container mx-auto p-4 sm:p-6 lg:p-8 flex flex-col items-center justify-center">
        <!-- Theme Toggle Switch -->
        <div class="absolute top-4 right-4 sm:top-6 sm:right-6">
            <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 focus:ring-offset-gray-100 dark:focus:ring-offset-gray-900">
                <svg id="theme-icon-sun" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                <svg id="theme-icon-moon" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
            </button>
        </div>

        <!-- Upload View -->
        <div id="upload-view" class="w-full max-w-2xl text-center">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                <h1 class="text-3xl sm:text-4xl font-bold mb-2 text-gray-900 dark:text-white">MCQ Practice App</h1>
                <p class="text-gray-600 dark:text-gray-400 mb-6">Upload your PDF, DOCX, or TXT file to start your quiz.</p>
                <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 sm:p-12 cursor-pointer hover:border-blue-500 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors" id="drop-zone">
                    <input type="file" id="file-input" class="hidden" accept=".pdf,.docx,.txt">
                    <svg class="mx-auto h-12 w-12 text-gray-400 dark:text-gray-500" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <p class="mt-4 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold text-blue-600 dark:text-blue-400">Click to upload</span> or drag and drop</p>
                    <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">PDF, DOCX, or TXT files</p>
                </div>
                <div id="file-name" class="mt-4 text-sm text-gray-700 dark:text-gray-300 font-medium"></div>
                <button id="start-quiz-btn" class="mt-6 w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-all transform hover:scale-105 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed" disabled>Start Quiz</button>
                 <div id="loading-spinner" class="hidden mt-4">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                    <p class="text-gray-600 dark:text-gray-400 mt-2">Parsing your file...</p>
                </div>
                 <div id="error-message" class="mt-4 text-red-500 text-sm font-medium"></div>
            </div>
        </div>

        <!-- Quiz View -->
        <div id="quiz-view" class="hidden w-full max-w-6xl">
            <div class="flex flex-col md:flex-row md:space-x-8">
                <!-- Question Navigation Panel (Left/Top) -->
                <div class="w-full md:w-48 mb-6 md:mb-0 flex-shrink-0">
                    <h3 class="text-lg font-bold mb-3 text-gray-800 dark:text-gray-200">Questions</h3>
                    <div id="question-nav-panel" class="grid grid-cols-5 sm:grid-cols-7 md:grid-cols-4 gap-2 md:max-h-[60vh] md:overflow-y-auto pr-2">
                        <!-- Navigation buttons will be injected here -->
                    </div>
                </div>

                <!-- Main Quiz Content (Right/Bottom) -->
                <div class="w-full">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white" id="quiz-round-title">Quiz Time!</h2>
                        <div id="progress-tracker" class="text-right font-semibold text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 px-4 py-2 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                            Score: <span id="score">0</span> / <span id="total-questions">0</span>
                        </div>
                    </div>

                    <div id="question-card" class="bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                        <p class="text-sm font-semibold text-blue-600 dark:text-blue-400 mb-2" id="question-number">Question X of Y</p>
                        <p class="text-lg sm:text-xl font-medium text-gray-800 dark:text-gray-100 mb-6" id="question-text"></p>
                        <div id="options-container" class="space-y-3">
                            <!-- Options will be dynamically inserted here -->
                        </div>
                    </div>

                    <div class="mt-6 flex justify-between items-center">
                        <button id="prev-btn" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 font-bold py-2 px-6 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">Previous</button>
                        <button id="next-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors">Next</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Results View -->
        <div id="results-view" class="hidden w-full max-w-2xl text-center">
             <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                <h2 class="text-3xl font-bold mb-2 text-gray-900 dark:text-white">Quiz Complete!</h2>
                <p class="text-lg text-gray-600 dark:text-gray-400 mb-6">Congratulations! You've answered all questions correctly.</p>

                <div class="text-6xl font-extrabold text-blue-600 dark:text-blue-400 mb-4" id="final-score"></div>
                <p class="text-gray-700 dark:text-gray-300 font-medium mb-8" id="score-percentage"></p>
                
                 <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <button id="download-results-btn" class="w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-all transform hover:scale-105">Download Summary</button>
                    <button id="restart-quiz-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-all transform hover:scale-105">Take Another Quiz</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Set up pdf.js worker
            pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;

            // --- State Management ---
            let questions = []; // Master list of all questions
            let currentQuizSetIndices = []; // Array of indices for the current round (all questions, or just incorrect ones)
            let currentPointer = 0; // Points to an index within currentQuizSetIndices
            let userAnswers = {}; // { originalQuestionIndex: { selectedOption: string, isCorrect: boolean } }
            let score = 0;
            let round = 1;

            // --- UI Elements ---
            const uploadView = document.getElementById('upload-view');
            const quizView = document.getElementById('quiz-view');
            const resultsView = document.getElementById('results-view');
            
            const fileInput = document.getElementById('file-input');
            const dropZone = document.getElementById('drop-zone');
            const fileNameDisplay = document.getElementById('file-name');
            const startQuizBtn = document.getElementById('start-quiz-btn');
            const loadingSpinner = document.getElementById('loading-spinner');
            const errorMessage = document.getElementById('error-message');

            const quizRoundTitle = document.getElementById('quiz-round-title');
            const questionNavPanel = document.getElementById('question-nav-panel');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const questionNumber = document.getElementById('question-number');
            const scoreDisplay = document.getElementById('score');
            const totalQuestionsDisplay = document.getElementById('total-questions');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            const finalScoreDisplay = document.getElementById('final-score');
            const scorePercentageDisplay = document.getElementById('score-percentage');
            const downloadResultsBtn = document.getElementById('download-results-btn');
            const restartQuizBtn = document.getElementById('restart-quiz-btn');

            // --- Theme Switcher Logic ---
            const themeToggle = document.getElementById('theme-toggle');
            const sunIcon = document.getElementById('theme-icon-sun');
            const moonIcon = document.getElementById('theme-icon-moon');
            
            const userTheme = localStorage.getItem('theme');
            const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches;

            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                } else {
                    document.documentElement.classList.remove('dark');
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                }
            };
            
            if ((userTheme === 'dark') || (!userTheme && systemTheme)) {
                applyTheme('dark');
            } else {
                applyTheme('light');
            }

            themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.classList.contains('dark');
                localStorage.setItem('theme', isDark ? 'light' : 'dark');
                applyTheme(isDark ? 'light' : 'dark');
            });


            // --- File Upload Logic ---
            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('border-blue-500', 'bg-gray-50', 'dark:bg-gray-700'); });
            dropZone.addEventListener('dragleave', (e) => { e.preventDefault(); dropZone.classList.remove('border-blue-500', 'bg-gray-50', 'dark:bg-gray-700'); });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-blue-500', 'bg-gray-50', 'dark:bg-gray-700');
                if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
            });
            fileInput.addEventListener('change', (e) => { if (e.target.files.length) handleFile(e.target.files[0]); });
            
            function handleFile(file) {
                if(file) {
                    fileNameDisplay.textContent = `File: ${file.name}`;
                    startQuizBtn.disabled = false;
                    errorMessage.textContent = '';
                }
            }

            startQuizBtn.addEventListener('click', async () => {
                const file = fileInput.files[0];
                if (!file) { showError("Please select a file first."); return; }
                loadingSpinner.classList.remove('hidden');
                startQuizBtn.disabled = true;
                errorMessage.textContent = '';
                try {
                    const textContent = await parseFile(file);
                    questions = parseMCQs(textContent);
                    if (questions.length === 0) throw new Error("Could not find any questions. Check file formatting.");
                    startNewQuiz();
                    switchToView('quiz');
                } catch (error) {
                    console.error("Parsing Error:", error);
                    showError(error.message || "Failed to parse the file.");
                } finally {
                    loadingSpinner.classList.add('hidden');
                    startQuizBtn.disabled = fileInput.files.length === 0;
                }
            });
            
            async function parseFile(file) {
                const extension = file.name.split('.').pop().toLowerCase();
                const reader = new FileReader();
                return new Promise((resolve, reject) => {
                    reader.onload = async (event) => {
                        try {
                            if (extension === 'txt') {
                                resolve(event.target.result);
                            } else if (extension === 'pdf') {
                                const pdfData = new Uint8Array(event.target.result);
                                const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
                                let fullText = '';
                                for (let i = 1; i <= pdf.numPages; i++) {
                                    const page = await pdf.getPage(i);
                                    const textContent = await page.getTextContent();
                                    const pageText = textContent.items.map(item => item.str).join(' ');
                                    fullText += pageText + '\n';
                                }
                                resolve(fullText);
                            } else if (extension === 'docx') {
                                const result = await mammoth.extractRawText({ arrayBuffer: event.target.result });
                                resolve(result.value);
                            } else { reject('Unsupported file type.'); }
                        } catch (err) {
                            console.error("File parsing error:", err);
                            reject(new Error("There was an error processing the file."));
                        }
                    };
                    reader.onerror = (error) => reject(error);
                    if (extension === 'txt') reader.readAsText(file);
                    else if (extension === 'pdf' || extension === 'docx') reader.readAsArrayBuffer(file);
                });
            }

            function parseMCQs(text) {
                text = text.replace(/\r\n/g, '\n').replace(/ +/g, ' ');
                const answerKeyRegex = /(?:Answer Key|ANSWERS|ANSWER KEY)[\s:.-]*([\s\S]*)/i;
                const answerKeyMatch = text.match(answerKeyRegex);
                if (!answerKeyMatch) throw new Error("Answer key section not found.");
                const answerKeyText = answerKeyMatch[1];
                const answers = {};
                const answerRegex = /(\d+)\s*[.)-]?\s*([A-Da-d])/g;
                let match;
                while ((match = answerRegex.exec(answerKeyText)) !== null) answers[match[1]] = match[2].toUpperCase();
                if (Object.keys(answers).length === 0) throw new Error("No answers found in the answer key.");

                const questionsText = text.substring(0, answerKeyMatch.index).trim();
                const parsedQuestions = [];
                const questionBlockRegex = /(\d+)\.\s+([\s\S]*?)(?=\s*\d+\.\s+|$)/g;
                while ((match = questionBlockRegex.exec(questionsText)) !== null) {
                    const questionNumber = match[1];
                    let blockContent = match[2].trim();
                    const firstOptionRegex = /\s+[A-Da-d][.)]/;
                    const firstOptionMatch = blockContent.match(firstOptionRegex);
                    if (!firstOptionMatch) continue;
                    const questionContent = blockContent.substring(0, firstOptionMatch.index).trim();
                    const optionsText = blockContent.substring(firstOptionMatch.index).trim();
                    const options = [];
                    const singleOptionRegex = /([A-Da-d])[.)]\s+([\s\S]*?)(?=\s+[A-Da-d][.)]|$)/g;
                    let optionMatch;
                    while ((optionMatch = singleOptionRegex.exec(optionsText)) !== null) {
                        options.push({ letter: optionMatch[1].toUpperCase(), text: optionMatch[2].trim() });
                    }
                    if (questionContent && options.length >= 2 && answers[questionNumber]) {
                        parsedQuestions.push({ number: questionNumber, text: questionContent, options: options, correctAnswer: answers[questionNumber] });
                    }
                }
                return parsedQuestions;
            }

            // --- Quiz Logic ---
            
            function startNewQuiz() {
                resetQuizState();
                currentQuizSetIndices = questions.map((_, i) => i); // Start with all questions
                displayQuestion(currentQuizSetIndices[currentPointer]);
                renderNavigationPanel();
            }

            function displayQuestion(originalIndex) {
                if (originalIndex === undefined) return;

                const question = questions[originalIndex];
                questionText.textContent = question.text;
                questionNumber.textContent = `Question ${question.number}`;
                optionsContainer.innerHTML = '';

                question.options.forEach(option => {
                    const button = document.createElement('button');
                    button.className = 'option-btn w-full text-left p-4 border-2 border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 hover:border-blue-400 dark:hover:border-blue-500';
                    button.innerHTML = `<span class="font-bold mr-2">${option.letter}.</span> ${option.text}`;
                    button.dataset.letter = option.letter;
                    button.addEventListener('click', () => handleOptionSelect(originalIndex, option.letter, button));
                    optionsContainer.appendChild(button);
                });

                if(userAnswers[originalIndex]){
                    const { selectedOption, isCorrect } = userAnswers[originalIndex];
                    optionsContainer.querySelectorAll('.option-btn').forEach(btn => {
                        if (btn.dataset.letter === selectedOption) btn.classList.add(isCorrect ? 'correct' : 'incorrect', 'selected');
                        if (!isCorrect && btn.dataset.letter === question.correctAnswer) btn.classList.add('correct-answer-reveal');
                        btn.disabled = true;
                    });
                }
                
                updateNavigation();
                updateProgress();
                renderNavigationPanel();
            }

            function handleOptionSelect(originalIndex, selectedLetter) {
                if (userAnswers[originalIndex]) return; // Already answered this round

                const question = questions[originalIndex];
                const isCorrect = selectedLetter === question.correctAnswer;
                
                userAnswers[originalIndex] = { selectedOption: selectedLetter, isCorrect };
                
                if (isCorrect) score++;
                
                displayQuestion(originalIndex); // Re-render to show feedback

                // Auto-advance to next question after a short delay
                setTimeout(() => {
                    if (currentPointer < currentQuizSetIndices.length - 1) {
                        currentPointer++;
                        displayQuestion(currentQuizSetIndices[currentPointer]);
                    } else {
                        // User has reached the end of the current round
                        finishRound();
                    }
                }, 1200);
            }

             function finishRound() {
                const incorrectQuestionIndices = questions
                    .map((_, i) => i)
                    .filter(i => !userAnswers[i] || !userAnswers[i].isCorrect);
                
                if (incorrectQuestionIndices.length === 0) {
                    showResults();
                } else {
                    round++;
                    quizRoundTitle.textContent = `Round ${round}: Retry Incorrect`;

                    // Clear the previous incorrect answers to allow re-answering.
                    incorrectQuestionIndices.forEach(index => {
                        delete userAnswers[index];
                    });

                    currentQuizSetIndices = incorrectQuestionIndices;
                    currentPointer = 0;
                    displayQuestion(currentQuizSetIndices[currentPointer]);
                    renderNavigationPanel();
                }
            }
            
            function renderNavigationPanel() {
                questionNavPanel.innerHTML = '';
                questions.forEach((q, index) => {
                    const navBtn = document.createElement('button');
                    const status = userAnswers[index];
                    let bgColor = 'bg-white dark:bg-gray-700';
                    let textColor = 'text-gray-700 dark:text-gray-200';
                    let borderColor = 'border-gray-300 dark:border-gray-600';

                    if (status) {
                        if (status.isCorrect) {
                            bgColor = 'bg-green-500';
                            textColor = 'text-white';
                            borderColor = 'border-green-600 dark:border-green-500';
                        } else {
                            bgColor = 'bg-red-500';
                            textColor = 'text-white';
                            borderColor = 'border-red-600 dark:border-red-500';
                        }
                    }
                    
                    if (index === currentQuizSetIndices[currentPointer]) {
                        borderColor = 'border-blue-500 ring-2 ring-blue-500';
                    }

                    navBtn.className = `w-10 h-10 rounded-md font-bold flex items-center justify-center border-2 transition-colors ${bgColor} ${textColor} ${borderColor}`;
                    navBtn.textContent = q.number;
                    navBtn.addEventListener('click', () => {
                        // Find the question in the current round, or jump to it if not in round
                         const pointerIndex = currentQuizSetIndices.indexOf(index);
                         if (pointerIndex > -1) {
                            currentPointer = pointerIndex;
                            displayQuestion(index);
                         }
                    });
                    questionNavPanel.appendChild(navBtn);
                });
            }

            function updateNavigation() {
                prevBtn.disabled = currentPointer === 0;
                if (currentPointer === currentQuizSetIndices.length - 1) {
                    nextBtn.textContent = 'Finish Round';
                } else {
                    nextBtn.textContent = 'Next';
                }
            }

            function updateProgress() {
                scoreDisplay.textContent = score;
                totalQuestionsDisplay.textContent = questions.length;
            }
            
            prevBtn.addEventListener('click', () => {
                if (currentPointer > 0) {
                    currentPointer--;
                    displayQuestion(currentQuizSetIndices[currentPointer]);
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentPointer < currentQuizSetIndices.length - 1) {
                    currentPointer++;
                    displayQuestion(currentQuizSetIndices[currentPointer]);
                } else {
                    finishRound();
                }
            });

            // --- Results Logic ---
            function showResults() {
                finalScoreDisplay.textContent = `${score} / ${questions.length}`;
                scorePercentageDisplay.textContent = `Final Score: 100%`;
                switchToView('results');
            }
            
            downloadResultsBtn.addEventListener('click', () => {
                let reportContent = `MCQ Quiz Summary - Final Score: ${score}/${questions.length}\n`;
                reportContent += "========================================\n\n";
                questions.forEach((q, index) => {
                    const answer = userAnswers[index];
                    const correctAnswerText = q.options.find(opt => opt.letter === q.correctAnswer).text;
                    reportContent += `Q${q.number}: ${q.text}\n`;
                    reportContent += `  - Correct Answer: ${correctAnswerText}\n`;
                    reportContent += `  - Your Final Choice: ${answer ? q.options.find(opt => opt.letter === answer.selectedOption).text : 'N/A'}\n\n`;
                });
                const blob = new Blob([reportContent], { type: 'text/plain' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'mcq_quiz_summary.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });
            
            restartQuizBtn.addEventListener('click', () => {
                resetUploadView();
                switchToView('upload');
            });
            
            // --- General App Flow ---
            function switchToView(viewName) {
                ['upload', 'quiz', 'results'].forEach(v => document.getElementById(`${v}-view`).classList.add('hidden'));
                document.getElementById(`${viewName}-view`).classList.remove('hidden');
            }
            
            function resetQuizState() {
                currentQuizSetIndices = [];
                currentPointer = 0;
                userAnswers = {};
                score = 0;
                round = 1;
                quizRoundTitle.textContent = `Round 1`;
            }
            
            function resetUploadView() {
                fileInput.value = '';
                fileNameDisplay.textContent = '';
                startQuizBtn.disabled = true;
                errorMessage.textContent = '';
            }
            
            function showError(message) {
                 errorMessage.textContent = message;
                 loadingSpinner.classList.add('hidden');
                 startQuizBtn.disabled = fileInput.files.length === 0;
            }
        });
    </script>
</body>
</html>
